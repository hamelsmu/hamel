<a href="../../index.html" class="navbar-brand navbar-brand-logo"><img
src="../../quarto.png" class="navbar-logo" alt="Quarto logo." /></a>

<span class="navbar-toggler-icon"></span>

-   <a href="../../index.html" class="nav-link"><span
    class="menu-text">Overview</span></a>
-   <a href="../../docs/get-started/index.html" class="nav-link"><span
    class="menu-text">Get Started</span></a>
-   <a href="../../docs/guide/index.html" class="nav-link"><span
    class="menu-text">Guide</span></a>
-   <a href="../../docs/extensions/index.html" class="nav-link active"
    aria-current="page"><span class="menu-text">Extensions</span></a>
-   <a href="../../docs/reference/index.html" class="nav-link"><span
    class="menu-text">Reference</span></a>
-   <a href="../../docs/gallery/index.html" class="nav-link"><span
    class="menu-text">Gallery</span></a>
-   <a href="../../docs/blog/index.html" class="nav-link"><span
    class="menu-text">Blog</span></a>
-   <a href="#" id="nav-menu-help" class="nav-link dropdown-toggle"
    role="button" data-bs-toggle="dropdown" aria-expanded="false"><span
    class="menu-text">Help</span></a>
    -   <a href="https://github.com/quarto-dev/quarto-cli/issues"
        class="dropdown-item"><em></em> <span class="dropdown-text">Report a
        Bug</span></a>
    -   <a href="https://github.com/quarto-dev/quarto-cli/discussions"
        class="dropdown-item"><em></em> <span class="dropdown-text">Ask a
        Question</span></a>
    -   <a href="../../docs/faq/index.html" class="dropdown-item"><em></em>
        <span class="dropdown-text">FAQ</span></a>

<a href="https://twitter.com/quarto_pub"
class="quarto-navigation-tool px-1" aria-label="Quarto Twitter"
title="Quarto Twitter"><em></em></a>
<a href="https://github.com/quarto-dev/quarto-cli"
class="quarto-navigation-tool px-1" aria-label="Quarto GitHub"
title="Quarto GitHub"><em></em></a>
<a href="https://quarto.org/docs/blog/index.xml"
class="quarto-navigation-tool px-1" aria-label="Quarto Blog RSS"
title="Quarto Blog RSS"><em></em></a>

1.  [Creating Extensions](../../docs/extensions/creating.html)
2.  [Filters](../../docs/extensions/filters.html)

<span class="flex-grow-1" role="button" bs-toggle="collapse"
bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar"
aria-expanded="false" aria-label="Toggle sidebar navigation"
onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"></span>

-   

    ------------------------------------------------------------------------

-   <a href="../../docs/extensions/index.html"
    class="sidebar-item-text sidebar-link"><span class="menu-text">Quarto
    Extensions</span></a> <span class="sidebar-item-toggle text-start"
    bs-toggle="collapse" bs-target="#quarto-sidebar-section-1"
    aria-expanded="true" aria-label="Toggle section"></span>

    -   <a href="../../docs/extensions/listing-filters.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Shortcodes &amp; Filters</span></a>

    -   <a href="../../docs/extensions/listing-journals.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Journal
        Articles</span></a>

    -   <a href="../../docs/extensions/listing-formats.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Custom
        Formats</span></a>

    -   <a href="../../docs/extensions/listing-revealjs.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Revealjs
        Extensions</span></a>

    -   <a href="../../docs/extensions/managing.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Managing
        Extensions</span></a>

-   

    ------------------------------------------------------------------------

-   <a href="../../docs/extensions/creating.html"
    class="sidebar-item-text sidebar-link"><span class="menu-text">Creating
    Extensions</span></a> <span class="sidebar-item-toggle text-start"
    bs-toggle="collapse" bs-target="#quarto-sidebar-section-2"
    aria-expanded="true" aria-label="Toggle section"></span>

    -   <a href="../../docs/extensions/creating.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Overview</span></a>

    -   <a href="../../docs/extensions/lua.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Lua
        Development</span></a>

    -   <a href="../../docs/extensions/lua-api.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Lua API
        Reference</span></a>

    -   <a href="../../docs/extensions/distributing.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Distribution</span></a>

    -   

        ------------------------------------------------------------------------

    -   <a href="../../docs/extensions/shortcodes.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Shortcodes</span></a>

    -   <a href="../../docs/extensions/filters.html"
        class="sidebar-item-text sidebar-link active"><span
        class="menu-text">Filters</span></a>

    -   <a href="../../docs/journals/formats.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Journal
        Articles</span></a> <span
        class="sidebar-item-toggle text-start collapsed"
        bs-toggle="collapse" bs-target="#quarto-sidebar-section-3"
        aria-expanded="false" aria-label="Toggle section"></span>

        -   <a href="../../docs/journals/formats.html"
            class="sidebar-item-text sidebar-link"><span class="menu-text">Journal
            Formats</span></a>

        -   <a href="../../docs/journals/templates.html"
            class="sidebar-item-text sidebar-link"><span class="menu-text">Article
            Templates</span></a>

        -   <a href="../../docs/journals/authors.html"
            class="sidebar-item-text sidebar-link"><span class="menu-text">Authors
            &amp; Affiliations</span></a>

    -   <a href="../../docs/extensions/formats.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Custom
        Formats</span></a>

    -   <a href="../../docs/extensions/revealjs.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Revealjs
        Plugins</span></a>

    -   <a href="../../docs/extensions/project-types.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Project
        Types</span></a>

    -   <a href="../../docs/extensions/starter-templates.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Starter
        Templates</span></a>

## On this page

-   <a href="#overview" id="toc-overview" class="nav-link active"
    data-scroll-target="#overview">Overview</a>
-   <a href="#activating-filters" id="toc-activating-filters"
    class="nav-link" data-scroll-target="#activating-filters">Activating
    Filters</a>
-   <a href="#filter-extensions" id="toc-filter-extensions" class="nav-link"
    data-scroll-target="#filter-extensions">Filter Extensions</a>
    -   <a href="#quick-start" id="toc-quick-start" class="nav-link"
        data-scroll-target="#quick-start">Quick Start</a>
    -   <a href="#development" id="toc-development" class="nav-link"
        data-scroll-target="#development">Development</a>
    -   <a href="#distribution" id="toc-distribution" class="nav-link"
        data-scroll-target="#distribution">Distribution</a>
    -   <a href="#examples" id="toc-examples" class="nav-link"
        data-scroll-target="#examples">Examples</a>

-   <a
    href="https://github.com/quarto-dev/quarto-web/edit/main/docs/extensions/filters.qmd"
    class="toc-action"><em></em>Edit this page</a>
-   <a href="https://github.com/quarto-dev/quarto-cli/issues/new/choose"
    class="toc-action"><em></em>Report an issue</a>

1.  [Creating Extensions](../../docs/extensions/creating.html)
2.  [Filters](../../docs/extensions/filters.html)

# Creating Filters

## Overview

If the base features of Pandoc and Quarto don’t do exactly what you
need, you can very likely create a [Pandoc
Filter](https://pandoc.org/filters.html) that bridges the gap.

Pandoc consists of a set of readers and writers. When converting a
document from one format to another, text is parsed by a reader into
pandoc’s intermediate representation of the document—an “abstract syntax
tree” or AST—which is then converted by the writer into the target
format. The pandoc AST format is defined in the module
[`Text.Pandoc.Definition`](https://hackage.haskell.org/package/pandoc-types-1.22/docs/Text-Pandoc-Definition.html)
in the pandoc-types package.

A “filter” is a program that modifies the AST, between the reader and
the writer.

    INPUT --reader--> AST --filter--> AST --writer--> OUTPUT

Pandoc’s built-in citation processing is implemented as a filter, as are
many of Quarto’s internal extensions (e.g. cross-references, figure
layout, etc.).

You can write Pandoc filters using Lua (via Pandoc’s built-in Lua
interpreter) or using any other language using a JSON representation of
the Pandoc AST piped to/from an external process. We strongly recommend
using Lua Filters, which have the following advantages:

-   No external dependencies
-   High performance (no serialization or process execution overhead)
-   Access to the
    [Pandoc](https://pandoc.org/lua-filters.html#pandoc-module) and
    [Quarto](../../docs/extensions/lua.html) libraries of Lua helper
    functions.

## Activating Filters

If you’ve developed a filter and want to use it within a document you
need to add it to the list of `filters` for the document. For example,
here we arrange for the
[spellcheck](https://github.com/pandoc/lua-filters/tree/master/spellcheck)
filter to run:

    ---
    filters:
      - spellcheck.lua
    ---

By default, user filters are run before Quarto’s built-in filters. For
some filters you’ll want to modify this behavior. For example, here we
arrange to run `spellcheck` before Quarto’s filters and `lightbox`
after:

    filters:
      - spellcheck.lua
      - quarto
      - lightbox

You’ll notice that one of the extensions (`spellcheck.lua`) has a file
extension and the other (`lightbox`) does not. This difference stems
from how the extensions are distributed: an extension distributed as a
plain Lua file uses `.lua` whereas a filter distributed as a [Quarto
Extension](../../docs/extensions/index.html) does not. The next section
explores how to create filters as extensions.

## Filter Extensions

### Quick Start

Here we’ll describe how to create a simple filter extension. We’ll use
the `quarto create` command to do this. If you are using VS Code or
RStudio you should execute `quarto create` within their respective
integrated Terminal panes.

To get started, execute `quarto create extension filter` within the
parent directory where you’d like the filter extension to be created:

    Terminal

    $ quarto create extension filter
     ? Extension Name › fancy-header

As shown above, you’ll be prompted for an extension name. Type
`fancy-header` and press Enter—the filter extension is then created:

    Creating extension at /Users/jjallaire/quarto/dev/fancy-header:
      - Created README.md
      - Created _extensions/fancy-header/_extension.yml
      - Created _extensions/fancy-header/fancy-header.lua
      - Created .gitignore
      - Created example.qmd

If you are running within VS Code or RStudio a new window will open with
the extension project.

Here’s what the contents of the files in `_extensions/fancy-header/`
look like:

    _extensions/fancy-header/_extension.yml

    title: Fancy-header
    author: J.J. Allaire
    version: 1.0.0
    quarto-required: ">=99.9.0"
    contributes:
      filters:
        - fancy-header.lua

    _extensions/fancy-header/fancy-header.lua

    -- Reformat all heading text 
    function Header(el)
      el.content = pandoc.Emph(el.content)
      return el
    end

Finally, the `example.qmd` file includes code that exercises the
extension. For example:

    example.qmd

    ---
    title: "Fancy-header Example"
    filters:
      - fancy-header
    ---

    ## Heading

    This filter adds formatting to heading text.

To develop your filter, render/preview `example.qmd`, and then make
changes to `fancy-header.lua` (the preview will automatically refresh
when you change `fancy-header.lua`).

### Development

To learn more about developing filter extensions:

1.  If necessary, brush up on [Lua
    Development](../../docs/extensions/lua.html) (Lua is the language
    used to create filters).

2.  Review the Pandoc documentation on [Writing Lua
    Filters](https://pandoc.org/lua-filters.html).

3.  Read the [Lua API Reference](../../docs/extensions/lua-api.html),
    which describes the Lua extension API for Quarto.

If you want to write a JSON filter, see the documentation on [Writing
JSON filters](https://pandoc.org/filters.html).

To create a new filter extension, use the
`quarto create extension filter` command as described above.

### Distribution

if your extension source code it located within a GitHub repository,
then it can be added to a project by referencing the GitHub organization
and repository name. For example:

    Terminal

    # target the current HEAD of the extension
    quarto add cooltools/output-folding

    # target a branch or tagged release of the extension
    quarto add cooltools/output-folding@v1.2
    quarto add cooltools/output-folding@bugfix-22

Note that it is possible to bundle and distribute extensions as simple
gzip archives (as opposed to using a GitHub repository as described
above). See the article on [Distributing
Extensions](../../docs/extensions/distributing.html) for additional
details.

### Examples

You might also find it instructive to examine the source code of these
filter extensions authored by the Quarto team:

<table class="table">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="header header">
<th><strong>Extension name</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd odd">
<td><a
href="https://github.com/quarto-ext/latex-environment">latex-environment</a></td>
<td>Quarto extension to output custom LaTeX environments.</td>
</tr>
<tr class="even even">
<td><a href="https://github.com/quarto-ext/lightbox">lightbox</a></td>
<td>Create lightbox treatments for images in your HTML documents.</td>
</tr>
</tbody>
</table>

<a href="../../docs/extensions/shortcodes.html"
class="pagination-link aria-label=" data-shortcodes"=""><em></em> <span
class="nav-page-text">Shortcodes</span></a>

<a href="../../docs/journals/formats.html" class="pagination-link"
aria-label="Journal Articles"><span class="nav-page-text">Journal
Articles</span> <em></em></a>

Proudly supported by [<img
src="https://www.rstudio.com/assets/img/posit-logo-fullcolor-TM.svg"
class="img-fluid" width="65" alt="Posit" />](https://posit.co)

-   <a href="../../about.html" class="nav-link"></a>

    About

-   <a href="../../docs/faq/index.html" class="nav-link"></a>

    FAQ

-   <a href="../../license.html" class="nav-link"></a>

    License

-   <a href="../../trademark.html" class="nav-link"></a>

    Trademark

-   <a href="https://twitter.com/quarto_pub" class="nav-link"><em></em></a>
-   <a href="https://github.com/quarto-dev/quarto-cli"
    class="nav-link"><em></em></a>
-   <a href="https://quarto.org/docs/blog/index.xml"
    class="nav-link"><em></em></a>
