<a href="../../index.html" class="navbar-brand navbar-brand-logo"><img
src="../../quarto.png" class="navbar-logo" alt="Quarto logo." /></a>

<span class="navbar-toggler-icon"></span>

-   <a href="../../index.html" class="nav-link"><span
    class="menu-text">Overview</span></a>
-   <a href="../../docs/get-started/index.html" class="nav-link"><span
    class="menu-text">Get Started</span></a>
-   <a href="../../docs/guide/index.html" class="nav-link"><span
    class="menu-text">Guide</span></a>
-   <a href="../../docs/extensions/index.html" class="nav-link active"
    aria-current="page"><span class="menu-text">Extensions</span></a>
-   <a href="../../docs/reference/index.html" class="nav-link"><span
    class="menu-text">Reference</span></a>
-   <a href="../../docs/gallery/index.html" class="nav-link"><span
    class="menu-text">Gallery</span></a>
-   <a href="../../docs/blog/index.html" class="nav-link"><span
    class="menu-text">Blog</span></a>
-   <a href="#" id="nav-menu-help" class="nav-link dropdown-toggle"
    role="button" data-bs-toggle="dropdown" aria-expanded="false"><span
    class="menu-text">Help</span></a>
    -   <a href="https://github.com/quarto-dev/quarto-cli/issues"
        class="dropdown-item"><em></em> <span class="dropdown-text">Report a
        Bug</span></a>
    -   <a href="https://github.com/quarto-dev/quarto-cli/discussions"
        class="dropdown-item"><em></em> <span class="dropdown-text">Ask a
        Question</span></a>
    -   <a href="../../docs/faq/index.html" class="dropdown-item"><em></em>
        <span class="dropdown-text">FAQ</span></a>

<a href="https://twitter.com/quarto_pub"
class="quarto-navigation-tool px-1" aria-label="Quarto Twitter"
title="Quarto Twitter"><em></em></a>
<a href="https://github.com/quarto-dev/quarto-cli"
class="quarto-navigation-tool px-1" aria-label="Quarto GitHub"
title="Quarto GitHub"><em></em></a>
<a href="https://quarto.org/docs/blog/index.xml"
class="quarto-navigation-tool px-1" aria-label="Quarto Blog RSS"
title="Quarto Blog RSS"><em></em></a>

1.  [Creating Extensions](../../docs/extensions/creating.html)
2.  [Shortcodes](../../docs/extensions/shortcodes.html)

<span class="flex-grow-1" role="button" bs-toggle="collapse"
bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar"
aria-expanded="false" aria-label="Toggle sidebar navigation"
onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"></span>

-   

    ------------------------------------------------------------------------

-   <a href="../../docs/extensions/index.html"
    class="sidebar-item-text sidebar-link"><span class="menu-text">Quarto
    Extensions</span></a> <span class="sidebar-item-toggle text-start"
    bs-toggle="collapse" bs-target="#quarto-sidebar-section-1"
    aria-expanded="true" aria-label="Toggle section"></span>

    -   <a href="../../docs/extensions/listing-filters.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Shortcodes &amp; Filters</span></a>

    -   <a href="../../docs/extensions/listing-journals.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Journal
        Articles</span></a>

    -   <a href="../../docs/extensions/listing-formats.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Custom
        Formats</span></a>

    -   <a href="../../docs/extensions/listing-revealjs.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Revealjs
        Extensions</span></a>

    -   <a href="../../docs/extensions/managing.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Managing
        Extensions</span></a>

-   

    ------------------------------------------------------------------------

-   <a href="../../docs/extensions/creating.html"
    class="sidebar-item-text sidebar-link"><span class="menu-text">Creating
    Extensions</span></a> <span class="sidebar-item-toggle text-start"
    bs-toggle="collapse" bs-target="#quarto-sidebar-section-2"
    aria-expanded="true" aria-label="Toggle section"></span>

    -   <a href="../../docs/extensions/creating.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Overview</span></a>

    -   <a href="../../docs/extensions/lua.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Lua
        Development</span></a>

    -   <a href="../../docs/extensions/lua-api.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Lua API
        Reference</span></a>

    -   <a href="../../docs/extensions/distributing.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Distribution</span></a>

    -   

        ------------------------------------------------------------------------

    -   <a href="../../docs/extensions/shortcodes.html"
        class="sidebar-item-text sidebar-link active"><span
        class="menu-text">Shortcodes</span></a>

    -   <a href="../../docs/extensions/filters.html"
        class="sidebar-item-text sidebar-link"><span
        class="menu-text">Filters</span></a>

    -   <a href="../../docs/journals/formats.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Journal
        Articles</span></a> <span
        class="sidebar-item-toggle text-start collapsed"
        bs-toggle="collapse" bs-target="#quarto-sidebar-section-3"
        aria-expanded="false" aria-label="Toggle section"></span>

        -   <a href="../../docs/journals/formats.html"
            class="sidebar-item-text sidebar-link"><span class="menu-text">Journal
            Formats</span></a>

        -   <a href="../../docs/journals/templates.html"
            class="sidebar-item-text sidebar-link"><span class="menu-text">Article
            Templates</span></a>

        -   <a href="../../docs/journals/authors.html"
            class="sidebar-item-text sidebar-link"><span class="menu-text">Authors
            &amp; Affiliations</span></a>

    -   <a href="../../docs/extensions/formats.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Custom
        Formats</span></a>

    -   <a href="../../docs/extensions/revealjs.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Revealjs
        Plugins</span></a>

    -   <a href="../../docs/extensions/project-types.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Project
        Types</span></a>

    -   <a href="../../docs/extensions/starter-templates.html"
        class="sidebar-item-text sidebar-link"><span class="menu-text">Starter
        Templates</span></a>

## On this page

-   <a href="#overview" id="toc-overview" class="nav-link active"
    data-scroll-target="#overview">Overview</a>
-   <a href="#quick-start" id="toc-quick-start" class="nav-link"
    data-scroll-target="#quick-start">Quick Start</a>
-   <a href="#development" id="toc-development" class="nav-link"
    data-scroll-target="#development">Development</a>
-   <a href="#distribution" id="toc-distribution" class="nav-link"
    data-scroll-target="#distribution">Distribution</a>
-   <a href="#examples" id="toc-examples" class="nav-link"
    data-scroll-target="#examples">Examples</a>
    -   <a href="#raw-output" id="toc-raw-output" class="nav-link"
        data-scroll-target="#raw-output">Raw Output</a>
    -   <a href="#named-arguments" id="toc-named-arguments" class="nav-link"
        data-scroll-target="#named-arguments">Named Arguments</a>
    -   <a href="#metadata-options" id="toc-metadata-options" class="nav-link"
        data-scroll-target="#metadata-options">Metadata Options</a>
-   <a href="#raw-arguments" id="toc-raw-arguments" class="nav-link"
    data-scroll-target="#raw-arguments">Raw Arguments</a>
-   <a href="#escaping" id="toc-escaping" class="nav-link"
    data-scroll-target="#escaping">Escaping</a>

-   <a
    href="https://github.com/quarto-dev/quarto-web/edit/main/docs/extensions/shortcodes.qmd"
    class="toc-action"><em></em>Edit this page</a>
-   <a href="https://github.com/quarto-dev/quarto-cli/issues/new/choose"
    class="toc-action"><em></em>Report an issue</a>

1.  [Creating Extensions](../../docs/extensions/creating.html)
2.  [Shortcodes](../../docs/extensions/shortcodes.html)

# Creating Shortcodes

## Overview

Shortcodes are special markdown directives that generate various types
of content. Quarto shortcodes are similar in form and function to [Hugo
shortcodes](https://gohugo.io/content-management/shortcodes/) and
[WordPress shortcodes](https://codex.wordpress.org/Shortcode).

For example, the following shortcode prints the `title` from document
metadata:

    {{< meta title >}}

Quarto supports several shortcodes natively:

<table class="table">
<thead>
<tr class="header header">
<th>Shortcode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd odd">
<td><a href="../../docs/authoring/variables.html#var">var</a></td>
<td>Print value from <code>_variables.yml</code> file</td>
</tr>
<tr class="even even">
<td><a href="../../docs/authoring/variables.html#meta">meta</a></td>
<td>Print value from document metadata</td>
</tr>
<tr class="odd odd">
<td><a href="../../docs/authoring/variables.html#url">env</a></td>
<td>Print system environment variable</td>
</tr>
<tr class="even even">
<td><a
href="../../docs/authoring/markdown-basics.html#page-breaks">pagebreak</a></td>
<td>Insert a native page-break</td>
</tr>
<tr class="odd odd">
<td><a
href="../../docs/authoring/markdown-basics.html#keyboard-shortcuts">kbd</a></td>
<td>Describe keyboard shortcuts</td>
</tr>
<tr class="even even">
<td><a href="../../docs/authoring/videos.html">video</a></td>
<td>Embed a video in a document</td>
</tr>
<tr class="odd odd">
<td><a href="../../docs/authoring/includes.html">include</a></td>
<td>Include contents of another qmd</td>
</tr>
<tr class="even even">
<td><a href="../../docs/authoring/notebook-embed.html">embed</a></td>
<td>Embed cells from a Jupyter Notebook</td>
</tr>
</tbody>
</table>

This article describes how to create your own shortcodes.

## Quick Start

Here we’ll describe how to create a simple shortcode extension. We’ll
use the `quarto create` command to do this. If you are using VS Code or
RStudio, you should execute `quarto create` within their respective
integrated terminal panes.

To get started, execute `quarto create extension shortcode` within the
parent directory where you’d like the shortcode extension to be created:

    Terminal

    $ quarto create extension shortcode
     ? Extension Name › shorty

As shown above, you’ll be prompted for an extension name. Type `shorty`
and press Enter—the shortcode extension is then created:

    Creating extension at /Users/jjallaire/extensions/shorty/shorty:
      - Created README.md
      - Created _extensions/shorty/shorty.lua
      - Created _extensions/shorty/_extension.yml
      - Created .gitignore
      - Created example.qmd

If you are running within VS Code or RStudio, a new window will open
with the extension project.

Here’s what the contents of the files in `_extensions/shorty/` look
like:

    _extensions/shorty/_extension.yml

    title: Shorty
    author: J.J. Allaire
    version: 1.0.0
    quarto-required: ">=1.2.222"
    contributes:
      shortcodes:
        - shorty.lua

    _extensions/shorty/shorty.lua

    return {
      ['shorty'] = function(args, kwargs, meta) 
        return pandoc.Str("Hello from Shorty!")
      end
    }

Finally, the `example.qmd` file includes code that exercises the
extension. For example:

    example.qmd

    ---
    title: "Shorty Example"
    ---

To develop your shortcode, render/preview `example.qmd`, and then make
changes to `shorty.lua` (the preview will automatically refresh when you
change `shorty.lua`).

## Development

Shortcodes are created using Lua. If you aren’t familar with Lua (or
with Pandoc filters), here are some resources to help you along:

-   [Lua Development](../../docs/extensions/lua.html) (Lua is the
    language used to create shortcodes).

-   [Lua API Reference](../../docs/extensions/lua-api.html), which
    describes the Lua extension API for Quarto.

Shortcodes are implemented as Lua functions that take one or more
arguments and return a Pandoc AST node (or list of nodes).

Here’s the implementation of the `env` shortcode that is built in to
Quarto:

    env.lua

    function env(args)
      local var = pandoc.utils.stringify(args[1])
      local value = os.getenv(var)
      if value ~= nil then
        return pandoc.Str(value)
      else
        return pandoc.Null()
      end
    end

Note that arguments to shortcodes are provided in `args` (a
1-dimensional array), and that each argument is a list of Pandoc inlines
(i.e. markdown AST parsed from the text).

We use the `pandoc.utils.stringify()` function to convert the inlines to
an ordinary string, and then the `os.getenv()` function to get its
value.

You would use this shortcode as follows:

    {{< env HOME >}}

## Distribution

If your extension source code is located within a GitHub repository,
then it can be installed by referencing the GitHub organization and
repository name. For example:

    Terminal

    # install the current HEAD of the extension
    quarto add cooltools/shorty

    # install a branch or tagged release of the extension
    quarto add cooltools/shorty@v1.2
    quarto add cooltools/shorty@bugfix-22

Note that it is possible to bundle and distribute extensions as simple
gzip archives (as opposed to using a GitHub repository as described
above). See the article on [Distributing
Extensions](../../docs/extensions/distributing.html) for additional
details.

## Examples

You might find it instructive to examine the source code of these
shortcode extensions authored by the Quarto team:

<table class="table">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="header header">
<th><strong>Extension</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd odd">
<td><a
href="https://github.com/quarto-ext/fancy-text">fancy-text</a></td>
<td>Output nicely formatted versions of fancy strings such as LaTeX and
BibTeX in multiple formats.</td>
</tr>
<tr class="even even">
<td><a
href="https://github.com/quarto-ext/fontawesome">fontawesome</a></td>
<td>Use Font Awesome icons in HTML and PDF documents.</td>
</tr>
<tr class="odd odd">
<td><a
href="https://github.com/quarto-dev/quarto-cli/tree/main/src/resources/extensions/quarto/video">video</a></td>
<td>Embed videos in HTML documents and Revealjs presentations.</td>
</tr>
</tbody>
</table>

Some additional annotated examples are provided below.

### Raw Output

Shortcodes can tailor their output to the format being rendered to. This
is often useful when you want to conditionally generate rich HTML output
but still have the same document render properly to PDF or MS Word.

The `pagebreak` shortcode generates “native” pagebreaks in a variety of
formats. Here’s the implementation of `pagebreak`:

    pagebreak.lua

    function pagebreak()
     
      local raw = {
        epub = '<p style="page-break-after: always;"> </p>',
        html = '<div style="page-break-after: always;"></div>',
        latex = '\\newpage{}',
        ooxml = '<w:p><w:r><w:br w:type="page"/></w:r></w:p>',
        odt = '<text:p text:style-name="Pagebreak"/>',
        context = '\\page'
      }

      if quarto.doc.isFormat('docx') then
        return pandoc.RawBlock('openxml', raw.ooxml)
      elseif quarto.doc.isFormat('pdf')  then
        return pandoc.RawBlock('tex', raw.latex)
      elseif quarto.doc.isFormat('odt')  then
        return pandoc.RawBlock('opendocument', raw.odt)
      elseif quarto.doc.isFormat('epub') then
        return pandoc.RawBlock('html', raw.epub)
      elseif quarto.doc.isFormat('html') then
        return pandoc.RawBlock('html', raw.html)
      elseif quarto.doc.isFormat('context') then
        return pandoc.RawBlock('context', raw.context)
      else
        -- fall back to insert a form feed character
        return pandoc.Para{pandoc.Str '\f'}
      end

    end

We use the `pandoc.RawBlock()` function to output the appropriate raw
content for the target format. Note that raw blocks are passed straight
through to the output file and are not processed as markdown.

You’d use this shortcode as follows:

    {{< pagebreak >}}

### Named Arguments

The examples above use either a single argument (`env`) or no arguments
at all (`pagebreak`). Here we demonstrate named argument handling by
implementing a `git-rev` shortcode that prints the current git revision,
providing a `short` option to determine whether a short or long SHA1
value is displayed:

    git.lua

    -- run git and read its output
    function git(command)
      local p = io.popen("git " .. command)
      local output = p:read('*all')
      p:close()
      return output
    end

    -- return a table containing shortcode definitions
    -- defining shortcodes this way allows us to create helper 
    -- functions that are not themselves considered shortcodes 
    return {
      ["git-rev"] = function(args, kwargs)
        -- command line args
        local cmdArgs = ""
        local short = pandoc.utils.stringify(kwargs["short"])
        if short == "true" then
          cmdArgs = cmdArgs .. "--short "
        end
        
        -- run the command
        local cmd = "rev-parse " .. cmdArgs .. "HEAD"
        local rev = git(cmd)
        
        -- return as string
        return pandoc.Str(rev)
      end
    }

There are some new things demonstrated here:

1.  Rather than defining our shortcode functions globally, we return a
    table with the shortcode definitions. This allows us to define
    helper functions that are not themselves registered as shortcodes.
    It also enables us to define a shortcode with a dash (`-`) in its
    name.

2.  There is a new argument to our shortcode handler: `kwargs`. This
    holds any named arguments to the shortcode. As with `args`, values
    in `kwargs` will always be a list of Pandoc inlines (allowing you to
    accept markdown as an argument). Since `short` is a simple boolean
    value we need to call `pandoc.utils.stringify()` to treat it as a
    string and then compare it to `"true"`.

We’d use this shortcode as follows:

    ---
    title: "My Document"
    ---

    {{< git-rev >}}
    {{< git-rev short=true >}}

### Metadata Options

In some cases you may want to provide options that affect how your
shortcode behaves. There is a third argument to shortcode handlers
(`meta`) that provides access to document and/or project level metadata.

Let’s implement a different version of the `git-rev` shortcode that
emits the revision as a link to GitHub rather than plain text. To do
this, we make use of `github.owner` and `github.repo` metadata values:

    git.lua

    function git(command)
      local p = io.popen("git " .. command)
      local output = p:read('*all')
      p:close()
      return output
    end

    return {
      
      ["git-rev"] = function(args, kwargs, meta)
        -- run the command
        local rev = git("rev-parse HEAD")
        
        -- target repo
        local owner = pandoc.utils.stringify(meta["github.owner"])
        local repo = pandoc.utils.stringify(meta["github.repo"])
        local url = "https://github.com/" 
                    .. owner .. "/" .. repo .. "/" .. rev 
        
        -- return as link
        return pandoc.Link(pandoc.Str(rev), url)
      end
    }

As with `args` and `kwargs`, `meta` values are always provided as a list
of Pandoc inlines, so often need to be converted to string using
`pandoc.utils.stringify()`.

To use this shortcode in a document, we provide the GitHub info as
document options, then include the shortcode where we want the link to
be:

    ---
    title: "My Document"
    github:
      owner: quarto-dev
      repo: quarto-cli
    ---

    {{< git-rev >}}

The shortcode registration and GitHub metadata could just as well been
provided in a project-level `_quarto.yml` file or a directory-level
`_metadata.yml` file.

## Raw Arguments

In Quarto &gt;= 1.3 you can also access the raw stream of inlines passed
to a shortcode by adding a `raw_args` parameter. For example:

    function shorty(args, kwargs, meta, raw_args)

    end

## Escaping

If you are writing documentation about using variable shortcodes (for
example, this article!) you might need to prevent them from being
processed. You can do this in two ways:

1.  Escape the shortcode reference with extra braces like this:

        {{{< var version >}}}

2.  Add a `shortcodes=false` attribute to any code block you want to
    prevent processing of shortcodes within:

        ```{shortcodes=false}
        {{< var version >}}
        ```

<a href="../../docs/extensions/filters.html" class="pagination-link"
aria-label="Filters"><span class="nav-page-text">Filters</span>
<em></em></a>

Proudly supported by [<img
src="https://www.rstudio.com/assets/img/posit-logo-fullcolor-TM.svg"
class="img-fluid" width="65" alt="Posit" />](https://posit.co)

-   <a href="../../about.html" class="nav-link"></a>

    About

-   <a href="../../docs/faq/index.html" class="nav-link"></a>

    FAQ

-   <a href="../../license.html" class="nav-link"></a>

    License

-   <a href="../../trademark.html" class="nav-link"></a>

    Trademark

-   <a href="https://twitter.com/quarto_pub" class="nav-link"><em></em></a>
-   <a href="https://github.com/quarto-dev/quarto-cli"
    class="nav-link"><em></em></a>
-   <a href="https://quarto.org/docs/blog/index.xml"
    class="nav-link"><em></em></a>
